<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>http4r Example App</title>
    <script src="/js/tailwind-3.0.18.js"></script>
    <script src="/js/highlight.js"></script>
    <script src="/js/collapse.js"></script>
    <link rel="stylesheet" href="/css/styling.css" type="text/css"/>
</head>
<body>
<div class="flex full-width justify-between bg-colour p-4 sm:p-8 font text-xs sm:text-base">
    <div><a href="/" class="font text-lg no-underline">http4r</a></div>
    <div></div>
    <div class="flex space-around sm:w-1/3 w-1/2 justify-around">
        <div class="hidden sm:block"><a href="/docs/get-started" class="font no-underline">Get started</a></div>
        <div class="ml-4"><a href="/docs/recipes" class="font no-underline">Recipes</a></div>
    </div>
</div>
<div class="flex flex-col items-center px-4 py-2 sm:px-10 sm:pt-8 collapsible collapsed">
    <span>installing Rust ‚û°Ô∏è</span>
    <div class="doc-font block mb-10 w-4/5 md:w-2/3 2xl:w-2/5">
        Follow instructions from <a href="https://www.rust-lang.org/tools/install">rust-lang</a> to install rustup.
    </div>
</div>
<div class="flex flex-col items-center px-4 py-2 sm:px-10 sm:pt-8 collapsible collapsed">
    <span>making a new project ‚û°Ô∏è</span>
    <div class="doc-font block mb-2 w-4/5 md:w-2/3 2xl:w-2/5">
        Follow instructions about <a href="https://doc.rust-lang.org/cargo/commands/cargo-new.html">cargo</a> to make a
        new project.
    </div>
    <div class="doc-font block mb-10 w-4/5 md:w-2/3 2xl:w-2/5">
        Or run <code>cargo new &lt;my-project&gt;</code>
    </div>
</div>
<div class="flex flex-col items-center px-4 py-2 sm:px-10 sm:pt-8 collapsible collapsed">
    <span>add http4r ‚û°Ô∏è</span>
    <div class="doc-font block mb-10 w-4/5 md:w-2/3 2xl:w-2/5">
        Run <code>cargo install http4r-core</code> as described <a
            href="https://doc.rust-lang.org/cargo/commands/cargo-install.html">here</a>.
    </div>
    <div class="doc-font block mb-10 w-4/5 md:w-2/3 2xl:w-2/5">
        Or add <code>http4r-core = "0.0.0"</code> to your <code>Cargo.toml</code>
    </div>
    <div class="doc-font block mb-10 w-4/5 md:w-2/3 2xl:w-2/5">
        The core library provides the fundamental building blocks, and other libraries build on top of it. That way you
        can have a small core library that doesn't bloat and you don't have to pull in lots of things just to build a
        small web app.
    </div>
</div>
<div class="flex flex-col items-center px-4 py-2 sm:px-10 sm:pt-8 collapsible collapsed">
    <span>hello world ‚û°Ô∏è</span>
    <div class="doc-font block mb-10 w-4/5 md:w-2/3 2xl:w-2/5">
        The most basic hello world example would be returning a 200 and "Hello, world!" to any request.
    </div>
    <div class="doc-font mb-10 w-4/5 md:w-2/3 2xl:w-2/5 hidden sm:block">
        <pre>
            <code>
fn main() {
    // define handler
    struct ok_handler;
    // implement Handler
    impl Handler for ok_handler {
        fn handle&lt;F&gt;(&mut self, _req: Request, fun: F) -> ()
            where F: FnOnce(Response) -> () + Sized {
            // call our response callback function "fun" on a 200 OK
            // with empty Headers and "Hello, world!" Body.
            fun(Response::ok(Headers::empty(), BodyString("Hello, world!")));
        }
    }
    // make a new server (0 means next available port to the OS)
    let mut server = Server::new(0);
    // start listening and use ok_handler to handle requests.
    server.start(|| { Ok(ok_handler) }, false);
}
            </code>
        </pre>
    </div>
</div>
<div class="flex flex-col items-center px-4 py-2 sm:px-10 sm:pt-8 collapsible collapsed">
    <span>project setup ‚û°Ô∏è</span>
    <div class="doc-font block mb-10 w-4/5 md:w-2/3 2xl:w-2/5">
        In case you are new to Rust, this is how I set up a project. You can take a look at the
        <code>http4r-example-app</code> (which these docs are written with!) <a
            href="https://github.com/TomShacham/http4r/tree/main/http4r-example-app">if you want a nicer view</a>.
    </div>
    <div class="doc-font mb-10 w-4/5 md:w-2/3 2xl:w-2/5 hidden sm:block">
        <img src="/images/project-structure.png" width="300px" height="auto"/>
    </div>
    <div class="doc-font block mb-10 w-4/5 md:w-2/3 2xl:w-2/5">
        The Rust language book has a <a
            href="https://doc.rust-lang.org/book/ch07-01-packages-and-crates.html">chapter
        on crates</a> explaining more about <code>lib.rs</code> and <a
            href="https://doc.rust-lang.org/cargo/guide/project-layout.html">project setup</a> in general.
    </div>
</div>
<div class="flex flex-col items-center px-4 py-2 sm:px-10 sm:pt-8 collapsible collapsed">
    <span>test-driving an app ‚û°Ô∏è</span>
    <div class="doc-font block mb-5 w-4/5 md:w-2/3 2xl:w-2/5">
        We're going to write a little app that we drive through tests. Part of the fun of having a really simple "server
        as a function" implementation is that we can really easily write a Handler and start it up as a server.
    </div>
    <div class="doc-font block mb-5 w-4/5 md:w-2/3 2xl:w-2/5">
        Let's write a test file called <code>app_test.rs</code>. The below will not compile until we write our
        ok_handler. But that's okay, we are driving the design with our test.
    </div>
    <div class="doc-font block mb-10 w-4/5 md:w-2/3 2xl:w-2/5">
        <pre><code>
// app_test.rs

#[cfg(test)]
mod tests {
    use http4r_core::client::Client;
    use http4r_core::handler::Handler;
    use http4r_core::headers::Headers;
    use http4r_core::http_message::Request;
    use http4r_core::http_message::Status::NotFound;
    use http4r_core::server::Server;
    use http4r_core::uri::Uri;

    #[test]
    fn not_found() {
        let mut server = Server::new(0);
        // start listening on next available port, close on finish = true
        server.start(|| { Ok(ok_handler) }, true);

        // request to some url we do not serve
        let request = Request::get(Uri::parse("/not-found"), Headers::empty());

        // make a client that points to localhost + whatever port our server started on.
        let mut client = Client::new("127.0.0.1", server.port, None);
        // make an http request to our server and assert response status is Not Found.
        client.handle(request, |res| {
            assert_eq!(res.status, NotFound);
            assert_eq!(body_string(res.body), "Not found.");
        })
    }
}
        </code></pre>
    </div>
    <div class="doc-font block mb-5 w-4/5 md:w-2/3 2xl:w-2/5">
        Now we need to write our <code>OkHandler</code>. Make a file in <code>src</code> called
        <code>ok_handler.rs</code>.
    </div>
    <div class="doc-font block mb-5 w-4/5 md:w-2/3 2xl:w-2/5">
        Add <code>pub mod ok_handler;</code> to <code>lib.rs</code> to include the file in our module tree.
    </div>
    <div class="doc-font block mb-5 w-4/5 md:w-2/3 2xl:w-2/5">
        Now add the following code to <code>ok_handler.rs</code>:
    </div>
    <div class="doc-font block mb-5 w-4/5 md:w-2/3 2xl:w-2/5">
        <pre><code>
// ok_handler.rs

use http4r_core::handler::Handler;
use http4r_core::headers::Headers;
use http4r_core::http_message::{Request, Response};
use http4r_core::http_message::Body::BodyString;

pub struct OkHandler;
impl Handler for OkHandler {
    fn handle&lt;F&gt;(&mut self, _req: Request, fun: F) -> () where F: FnOnce(Response) -> () + Sized {
        fun(Response::not_found(Headers::empty(), BodyString("Not found.")));
    }
}
        </code></pre>
    </div>
    <div class="doc-font block mb-5 w-4/5 md:w-2/3 2xl:w-2/5">
        And our test now passes!!! ü•≥ü•≥ü•≥
    </div>
    <div class="doc-font block mb-5 w-4/5 md:w-2/3 2xl:w-2/5">
        Clearly, just returning <code>NotFound</code> does not really fit the bill of an <code>OkHandler</code> though.
        So let's make it a bit more clever and work towards building a Router. First let's add to our test:
    </div>
    <div class="doc-font block mb-5 w-4/5 md:w-2/3 2xl:w-2/5">
        <pre><code>
// app_test.rs
// add the following lines to our test

let ok_request = Request::get(Uri::parse("/"), Headers::empty());
// make a request to root that we expect to be ok
client.handle(ok_request, |res| {
    assert_eq!(res.status, OK);
    assert_eq!(body_string(res.body), "Hello, world!");
})
        </code></pre>
    </div>
    <div class="doc-font block mb-5 w-4/5 md:w-2/3 2xl:w-2/5">
        Then let's implement: we want our root url to return 200 OK.
    </div>
    <div class="doc-font block mb-5 w-4/5 md:w-2/3 2xl:w-2/5">
        <pre><code>
// ok_handler.rs
// we are going to match on the request url
// and return a different response if it's to the root

use http4r_core::handler::Handler;
use http4r_core::headers::Headers;
use http4r_core::http_message::{Request, Response};
use http4r_core::http_message::Body::BodyString;
use http4r_core::uri::Uri;

pub struct OkHandler;

impl Handler for OkHandler {
    fn handle&lt;F&gt;(&mut self, req: Request, fun: F) -> () where F: FnOnce(Response) -> () + Sized {
        match req {
            Request { uri: Uri { path: "/", .. }, .. } => {
                fun(Response::ok(Headers::empty(), BodyString("Hello, world!")));
            }
            _ => {
                fun(Response::not_found(Headers::empty(), BodyString("Not found.")));
            }
        }
    }
}
        </code></pre>
    </div>
    <div class="doc-font block mb-5 w-4/5 md:w-2/3 2xl:w-2/5">
        And there we have it! We have test-driven a very simple app. You may notice something quite cool, our test runs
        in about 1ms! We can build up a test-suite of lots of functional tests like this and it won't take more than a
        second or two to run them all!
    </div>
</div>
<div class="flex flex-col items-center px-4 py-2 sm:px-10 sm:pt-8 collapsible collapsed">
    <span>routing ‚û°Ô∏è</span>

</div>
<div class="flex flex-col items-center px-4 py-2 sm:px-10 sm:pt-8 collapsible collapsed">
    <span>logging requests and responses ‚û°Ô∏è</span>

</div>
<div class="flex flex-col items-center px-4 py-2 sm:px-10 sm:pt-8 collapsible collapsed">
    <span>deploying to heroku ‚û°Ô∏è</span>
    <div class="doc-font block mb-10 w-4/5 md:w-2/3 2xl:w-2/5">
        coming soon...
    </div>
</div>
<div class="flex flex-col items-center px-4 py-2 sm:px-10 sm:pt-8 collapsible collapsed">
    <span>approval testing ‚û°Ô∏è</span>
    <div class="doc-font block mb-10 w-4/5 md:w-2/3 2xl:w-2/5">
        coming soon...
    </div>
</div>
<div class="flex flex-col items-center px-4 py-2 sm:px-10 sm:pt-8 collapsible collapsed">
    <span>tracing ‚û°Ô∏è</span>
    <div class="doc-font block mb-10 w-4/5 md:w-2/3 2xl:w-2/5">
        coming soon...
    </div>
</div>
</body>